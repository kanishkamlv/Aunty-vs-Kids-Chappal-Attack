<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>The Great Chappal Quest</title>
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        :root {
            --safe-bottom: env(safe-area-inset-bottom);
            --safe-left: env(safe-area-inset-left);
            --safe-right: env(safe-area-inset-right);
        }

        body, html {
            margin: 0;
            padding: 0;
            overflow: hidden;
            touch-action: none;
            background: #000;
        }

        #gameCanvas {
            display: block;
            margin: 0 auto;
            background: #ffffff;
        }

        .touch-controls {
            position: absolute;
            bottom: calc(var(--safe-bottom) + 30px);
            left: var(--safe-left);
            right: var(--safe-right);
            width: calc(100% - var(--safe-left) - var(--safe-right));
            display: none;
            justify-content: space-between;
            z-index: 100;
            padding: 0 25px;
            pointer-events: none;
        }

        .touch-btn {
            width: 62px;
            height: 62px;
            background: white;
            border-radius: 50%;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 28px;
            user-select: none;
            touch-action: manipulation;
            pointer-events: auto;
        }

        #restartBtn {
            margin-top: 20px;
        }
    </style>
</head>

<body>
    <canvas id="gameCanvas"></canvas>

    <!-- MOBILE TOUCH BUTTONS -->
    <div class="touch-controls">
        <div id="moveLeft" class="touch-btn">⟵</div>
        <div id="moveRight" class="touch-btn">⟶</div>
    </div>

    <script>
        const canvas = document.getElementById("gameCanvas");
        const ctx = canvas.getContext("2d");

        function resizeGame() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        }
        resizeGame();
        window.addEventListener("resize", resizeGame);

        // =============================
        // UPDATED IMAGE FILENAMES
        // =============================
       const assetSources = {
    aunty: "aunty.png?v=1",
    chappal: "chappal.png?v=1",
    enemy: "kid.png?v=1",
    bg: "building_bg.png?v=1",
    portrait: "portrait.png?v=2",  // bump version for updated portrait
    chai: "chai.png?v=1"
};


        const assets = {};
        let assetsLoaded = 0;
        const totalAssets = Object.keys(assetSources).length;

        function loadAssets() {
            for (let key in assetSources) {
                const img = new Image();
                img.src = assetSources[key];
                img.onload = () => {
                    assetsLoaded++;
                    if (assetsLoaded === totalAssets) startGame();
                };
                assets[key] = img;
            }
        }
        loadAssets();

        // =============================
        // ORIENTATION-BASED BACKGROUND
        // =============================
        let usePortraitBG = false;

        function checkOrientation() {
            usePortraitBG = window.innerHeight > window.innerWidth;
        }

        window.addEventListener("resize", checkOrientation);
        checkOrientation();

        // =============================
        // GAME STATE
        // =============================
        let aunty = { x: 150, y: 420, width: 120, height: 120, speed: 5 };
        let chappals = [];
        let enemies = [];
        let score = 0;
        let gameOver = false;

        let keys = { left: false, right: false };

        document.addEventListener("keydown", (e) => {
            if (e.key === "ArrowLeft") keys.left = true;
            if (e.key === "ArrowRight") keys.right = true;
        });

        document.addEventListener("keyup", (e) => {
            if (e.key === "ArrowLeft") keys.left = false;
            if (e.key === "ArrowRight") keys.right = false;
        });

        // MOBILE BUTTONS
        const moveLeft = document.getElementById("moveLeft");
        const moveRight = document.getElementById("moveRight");
        const controls = document.querySelector(".touch-controls");

        function enableMobileControls() {
            if (window.innerWidth < 900) {
                controls.style.display = "flex";
            }
        }
        enableMobileControls();

        moveLeft.addEventListener("touchstart", () => keys.left = true);
        moveLeft.addEventListener("touchend", () => keys.left = false);

        moveRight.addEventListener("touchstart", () => keys.right = true);
        moveRight.addEventListener("touchend", () => keys.right = false);

        function throwChappal() {
            chappals.push({ x: aunty.x + aunty.width / 2, y: aunty.y, size: 40 });
        }

        document.addEventListener("keydown", (e) => {
            if (e.key === " ") throwChappal();
        });

        function spawnEnemy()
